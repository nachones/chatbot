<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control - Chatbot</title>
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/calendar.css">
    <link rel="stylesheet" href="/css/auth.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-robot"></i>
                <span>MIA BOT</span>
            </div>
            <div class="chatbot-selector" id="chatbot-selector">
                <div class="chatbot-current" id="chatbot-current">
                    <span id="current-chatbot-name">Mi Chatbot</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="chatbot-dropdown hidden" id="chatbot-dropdown">
                    <div class="chatbot-list" id="chatbot-list">
                        <!-- Chatbots will be loaded here -->
                    </div>
                    <button class="btn-new-chatbot" id="btn-new-chatbot">
                        <i class="fas fa-plus"></i> Nuevo Chatbot
                    </button>
                </div>
            </div>
        </div>
        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" data-page="dashboard">
                <i class="fas fa-chart-line"></i>
                <span>Panel de Control</span>
            </a>
            <a href="#conversations" class="nav-item" data-page="conversations">
                <i class="fas fa-comments"></i>
                <span>Conversaciones</span>
            </a>
            <a href="#train" class="nav-item" data-page="train">
                <i class="fas fa-graduation-cap"></i>
                <span>Entrenar Chatbot</span>
            </a>
            <a href="#test" class="nav-item" data-page="test">
                <i class="fas fa-vial"></i>
                <span>Probar Chatbot</span>
            </a>
            <a href="#leads" class="nav-item" data-page="leads">
                <i class="fas fa-users"></i>
                <span>Contactos</span>
            </a>
            <a href="#calendar" class="nav-item" data-page="calendar">
                <i class="fas fa-calendar-alt"></i>
                <span>Agendar con Google</span>
            </a>
        </nav>
        <div class="sidebar-section">
            <div class="section-title">PERSONALIZACIÓN</div>
            <a href="#functions" class="nav-item" data-page="functions">
                <i class="fas fa-code"></i>
                <span>Funciones</span>
                <span class="badge">NUEVO</span>
            </a>
            <a href="#prompts" class="nav-item" data-page="prompts">
                <i class="fas fa-bolt"></i>
                <span>Respuestas Rápidas</span>
            </a>
            <a href="#appearance" class="nav-item" data-page="appearance">
                <i class="fas fa-palette"></i>
                <span>Apariencia</span>
            </a>
            <a href="#integrations" class="nav-item" data-page="integrations">
                <i class="fas fa-plug"></i>
                <span>Integraciones</span>
            </a>
            <a href="#settings" class="nav-item" data-page="settings">
                <i class="fas fa-cog"></i>
                <span>Configuración</span>
            </a>
        </div>
        <div class="sidebar-footer">
            <div class="nav-item user-display">
                <i class="fas fa-user-circle"></i>
                <span id="user-display-name" class="user-display-name">Usuario</span>
            </div>
            <a href="#" class="nav-item" onclick="window.logoutUser(); return false;">
                <i class="fas fa-sign-out-alt"></i>
                <span>Cerrar Sesión</span>
            </a>
        </div>
    </aside>
    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 id="page-title">Panel de Control</h1>
            </div>
            <div class="header-right">
                <div class="usage-indicator" id="usage-indicator">
                    <div class="usage-text">
                        <span>Tokens <i class="fas fa-info-circle"
                                title="Los tokens se resetean mensualmente"></i></span>
                        <span id="usage-count">0/100.000</span>
                    </div>
                    <div class="usage-bar">
                        <div class="usage-bar-fill" id="usage-bar-fill"></div>
                    </div>
                </div>
                <button class="btn btn-primary" id="integrate-btn">
                    <i class="fas fa-code"></i>
                    Integrar Chatbot
                </button>
            </div>
        </header>
        <div class="content">
        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page active">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-label">Mensajes Totales</span>
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="stat-value" id="total-messages">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-label">Conversaciones Totales</span>
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="stat-value" id="total-conversations">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-label">Elementos de Entrenamiento</span>
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="stat-value" id="total-training">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-label">Contactos Totales</span>
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="stat-value" id="total-leads">0</div>
                </div>
            </div>
            <!-- Charts Row -->
            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Historial de Chat</h3>
                        <div class="chart-tabs">
                            <button class="chart-tab active" data-period="1w">1S</button>
                            <button class="chart-tab" data-period="1m">1M</button>
                            <button class="chart-tab" data-period="3m">3M</button>
                            <button class="chart-tab" data-period="6m">6M</button>
                        </div>
                    </div>
                    <canvas id="chat-history-chart"></canvas>
                </div>
                <div class="conversations-card">
                    <div class="conversations-header">
                        <h3>Últimas Conversaciones</h3>
                        <a href="#conversations" class="view-all">Ver Todo</a>
                    </div>
                    <div id="recent-conversations" class="conversations-list">
                        <!-- Conversations will be loaded here -->
                    </div>
                </div>
            </div>
            <!-- Token Usage Card -->
            <div class="token-usage-card">
                <div class="token-header">
                    <h3><i class="fas fa-coins"></i> Uso de Tokens y Costes</h3>
                    <div class="token-period">
                        <select id="token-period" aria-label="Seleccionar período">
                            <option value="today">Hoy</option>
                            <option value="week">Esta Semana</option>
                            <option value="month" selected>Este Mes</option>
                            <option value="all">Todo el Tiempo</option>
                        </select>
                    </div>
                </div>
                <div class="token-stats">
                    <div class="token-stat">
                        <div class="token-label">Tokens Totales Usados</div>
                        <div class="token-value" id="total-tokens">0</div>
                    </div>
                    <div class="token-stat">
                        <div class="token-label">Tokens de Entrada</div>
                        <div class="token-value" id="input-tokens">0</div>
                    </div>
                    <div class="token-stat">
                        <div class="token-label">Tokens de Salida</div>
                        <div class="token-value" id="output-tokens">0</div>
                    </div>
                    <div class="token-stat">
                        <div class="token-label">Coste Estimado</div>
                        <div class="token-value cost" id="estimated-cost">0,00€</div>
                    </div>
                </div>
                <div class="token-chart">
                    <canvas id="token-usage-chart"></canvas>
                </div>
            </div>
        </div>
        <!-- Conversations Page -->
        <div id="page-conversations" class="page">
            <div class="conversations-layout">
                <!-- Sidebar with conversation list -->
                <div class="conversations-sidebar">
                    <div class="conversations-header">
                        <h3>Conversaciones</h3>
                        <div class="conversations-actions">
                            <button class="btn btn-secondary btn-sm" id="refresh-conversations" aria-label="Actualizar conversaciones">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="conversations-search">
                        <i class="fas fa-search"></i>
                        <input type="search" placeholder="Buscar conversaciones..." class="search-input" id="conversation-search" aria-label="Buscar conversaciones">
                    </div>
                    
                    <div class="conversations-filters">
                        <button class="filter-chip active" data-filter="all">
                            Todas <span class="chip-count" id="count-all">0</span>
                        </button>
                        <button class="filter-chip" data-filter="today">
                            Hoy <span class="chip-count" id="count-today">0</span>
                        </button>
                        <button class="filter-chip" data-filter="week">
                            Esta Semana
                        </button>
                    </div>
                    
                    <div id="conversations-list" class="conversations-list">
                        <!-- Conversations will be loaded here -->
                        <div class="empty-state-small">
                            <i class="fas fa-comments"></i>
                            <p>No hay conversaciones aún</p>
                        </div>
                    </div>
                </div>
                
                <!-- Chat View -->
                <div class="chat-view">
                    <div class="chat-empty-state" id="chat-empty-state">
                        <div class="empty-chat-icon">
                            <i class="fas fa-comment-dots"></i>
                        </div>
                        <h3>Selecciona una conversación</h3>
                        <p>Elige una conversación de la lista para ver los mensajes</p>
                    </div>
                    
                    <div class="chat-content hidden" id="chat-content">
                        <div class="chat-header">
                            <div class="chat-user-info">
                                <div class="user-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="user-details">
                                    <h4 id="chat-user-name">Usuario</h4>
                                    <span class="user-status" id="chat-session-id">Sesión</span>
                                </div>
                            </div>
                            <div class="chat-actions">
                                <button class="btn btn-secondary btn-sm" id="export-chat" aria-label="Exportar conversación">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                                <button class="btn btn-secondary btn-sm" id="delete-chat" aria-label="Eliminar conversación">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div id="chat-messages" class="chat-messages">
                            <!-- Messages will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Train Chatbot Page -->
        <div id="page-train" class="page">
            <!-- Hero Section -->
            <div class="train-hero">
                <div class="train-hero-content">
                    <h2><i class="fas fa-graduation-cap"></i> Entrena tu Chatbot</h2>
                    <p class="hero-subtitle">Añade conocimiento a tu chatbot para que pueda responder preguntas sobre tu negocio</p>
                </div>
            </div>
            
            <!-- Training Methods -->
            <div class="train-methods-horizontal">
                <div class="method-card-large" id="train-files">
                    <div class="method-icon-large">
                        <i class="fas fa-file-upload"></i>
                    </div>
                    <h3>Subir Archivos</h3>
                    <p>Sube documentos PDF, Word, TXT o Markdown para entrenar tu chatbot con información específica</p>
                    <div class="method-features">
                        <span class="feature-badge"><i class="fas fa-check"></i> PDF</span>
                        <span class="feature-badge"><i class="fas fa-check"></i> DOCX</span>
                        <span class="feature-badge"><i class="fas fa-check"></i> TXT</span>
                        <span class="feature-badge"><i class="fas fa-check"></i> MD</span>
                    </div>
                    <button class="btn-method-action" id="btn-upload-files" aria-label="Subir archivos">
                        <i class="fas fa-cloud-upload-alt"></i> Subir Archivos
                    </button>
                </div>
                
                <div class="method-card-large" id="train-url">
                    <div class="method-icon-large">
                        <i class="fas fa-globe"></i>
                    </div>
                    <h3>Entrenar desde URL</h3>
                    <p>Extrae automáticamente el contenido de páginas web para que tu chatbot aprenda de ellas</p>
                    <div class="method-features">
                        <span class="feature-badge"><i class="fas fa-check"></i> Automático</span>
                        <span class="feature-badge"><i class="fas fa-check"></i> HTML</span>
                        <span class="feature-badge"><i class="fas fa-check"></i> Blogs</span>
                    </div>
                    <button class="btn-method-action" id="btn-add-url" aria-label="Añadir URL">
                        <i class="fas fa-link"></i> Añadir URL
                    </button>
                </div>
                
                <div class="method-card-large" id="train-text">
                    <div class="method-icon-large">
                        <i class="fas fa-keyboard"></i>
                    </div>
                    <h3>Texto Directo</h3>
                    <p>Escribe directamente la información que quieres que tu chatbot conozca y utilice</p>
                    <div class="method-features">
                        <span class="feature-badge"><i class="fas fa-check"></i> FAQs</span>
                        <span class="feature-badge"><i class="fas fa-check"></i> Políticas</span>
                        <span class="feature-badge"><i class="fas fa-check"></i> Info</span>
                    </div>
                    <button class="btn-method-action" id="btn-add-text" aria-label="Añadir texto">
                        <i class="fas fa-edit"></i> Añadir Texto
                    </button>
                </div>
            </div>
            
            <!-- Training Data Section -->
            <div class="training-data-container">
                <div class="training-data-header">
                    <div class="header-left">
                        <h3><i class="fas fa-database"></i> Datos de Entrenamiento</h3>
                        <p class="header-subtitle">Contenido que tu chatbot ha aprendido</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary btn-sm" id="refresh-training" aria-label="Actualizar datos">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                </div>
                <div id="training-data-list" class="training-data-list">
                    <!-- Training data will be loaded here -->
                    <div class="empty-training-state">
                        <div class="empty-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h4>Sin datos de entrenamiento</h4>
                        <p>Comienza subiendo archivos, añadiendo URLs o escribiendo texto para entrenar tu chatbot</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Test Chatbot Page -->
        <div id="page-test" class="page">
            <div class="test-container-modern">
                <div class="test-sidebar">
                    <div class="test-info-card">
                        <div class="info-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <h3>Prueba tu Chatbot</h3>
                        <p>Envía mensajes para verificar que tu chatbot responde correctamente con la información que le has enseñado.</p>
                    </div>
                    
                    <div class="test-tips">
                        <h4><i class="fas fa-lightbulb"></i> Consejos</h4>
                        <ul>
                            <li>Prueba preguntas sobre el contenido que has añadido</li>
                            <li>Verifica que las respuestas sean precisas</li>
                            <li>Añade más contenido si las respuestas no son satisfactorias</li>
                        </ul>
                    </div>
                    
                    <div class="test-stats">
                        <h4><i class="fas fa-chart-bar"></i> Estadísticas de Prueba</h4>
                        <div class="stat-row">
                            <span>Mensajes enviados</span>
                            <span id="test-msg-count">0</span>
                        </div>
                        <div class="stat-row">
                            <span>Tiempo promedio</span>
                            <span id="test-avg-time">0ms</span>
                        </div>
                    </div>
                </div>
                
                <div class="test-chat-modern">
                    <div class="test-chat-header">
                        <div class="chat-header-left">
                            <div class="bot-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="bot-info">
                                <h3 id="test-bot-name">Mi Chatbot</h3>
                                <span class="bot-status"><i class="fas fa-circle"></i> En línea</span>
                            </div>
                        </div>
                        <button class="btn btn-secondary" id="clear-test-chat" aria-label="Limpiar chat">
                            <i class="fas fa-trash"></i> Limpiar
                        </button>
                    </div>
                    
                    <div id="test-messages" class="test-messages-modern">
                        <div class="message-wrapper bot">
                            <div class="message-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-bubble">¡Hola! Soy tu asistente virtual. ¿En qué puedo ayudarte hoy?</div>
                                <div class="message-time">Ahora</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="test-input-modern">
                        <div class="input-wrapper">
                            <input type="text" id="test-input" placeholder="Escribe tu mensaje..." 
                                   class="test-input" aria-label="Escribe tu mensaje">
                            <button id="test-send" class="btn-send-modern" aria-label="Enviar mensaje">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="input-hint">
                            <i class="fas fa-keyboard"></i>
                            <span>Presiona Enter para enviar</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Leads Page -->
        <div id="page-leads" class="page">
            <div class="leads-container">
                <div class="leads-header">
                    <h3>Contactos Capturados</h3>
                    <button class="btn btn-primary" id="export-leads" aria-label="Exportar contactos a CSV">
                        <i class="fas fa-download"></i> Exportar CSV
                    </button>
                </div>
                <div id="leads-table" class="leads-table">
                    <!-- Leads table will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Calendar / Google Agenda Page -->
        <div id="page-calendar" class="page">
            <div class="calendar-container">
                <!-- Estado: No conectado -->
                <div id="calendar-not-connected" class="calendar-setup">
                    <div class="calendar-setup-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h2>Agendar Citas con Google Calendar</h2>
                    <p>Permite que tu chatbot gestione citas automáticamente. Los visitantes podrán agendar directamente desde el chat.</p>
                    
                    <div class="calendar-features-grid">
                        <div class="calendar-feature">
                            <i class="fas fa-clock"></i>
                            <h4>Disponibilidad en tiempo real</h4>
                            <p>El chatbot consulta tu calendario y ofrece huecos libres.</p>
                        </div>
                        <div class="calendar-feature">
                            <i class="fas fa-robot"></i>
                            <h4>Agendado automático</h4>
                            <p>El visitante elige hora y el bot crea el evento.</p>
                        </div>
                        <div class="calendar-feature">
                            <i class="fas fa-envelope"></i>
                            <h4>Confirmación por email</h4>
                            <p>Ambas partes reciben notificación del evento.</p>
                        </div>
                    </div>
                    
                    <div id="calendar-plan-block" class="initially-hidden">
                        <div class="calendar-upgrade-notice">
                            <i class="fas fa-lock"></i>
                            <p>Esta función está disponible en los planes <strong>Pro</strong> y <strong>Empresas</strong>.</p>
                            <button class="btn btn-primary" onclick="window.location.href='/#pricing'">Mejorar Plan</button>
                        </div>
                    </div>
                    
                    <div id="calendar-connect-section">
                        <button class="btn btn-primary btn-lg" id="btn-connect-google">
                            <img src="https://www.gstatic.com/images/branding/product/1x/calendar_2020q4_48dp.png" alt="Google Calendar" class="google-calendar-icon">
                            Conectar Google Calendar
                        </button>
                        <p class="calendar-hint">Se abrirá una ventana de Google para autorizar el acceso a tu calendario.</p>
                    </div>
                </div>
                
                <!-- Estado: Conectado -->
                <div id="calendar-connected" class="initially-hidden">
                    <div class="calendar-status-bar">
                        <div class="calendar-status-info">
                            <span class="status-dot connected"></span>
                            <strong>Google Calendar conectado</strong>
                            <span id="calendar-email" class="calendar-email"></span>
                        </div>
                        <button class="btn btn-danger btn-sm" id="btn-disconnect-google">
                            <i class="fas fa-unlink"></i> Desconectar
                        </button>
                    </div>
                    
                    <!-- Configuración de disponibilidad -->
                    <div class="calendar-config-section">
                        <h3><i class="fas fa-clock"></i> Horario de Disponibilidad</h3>
                        <p class="section-desc">Define cuándo el chatbot puede agendar citas.</p>
                        
                        <div class="schedule-grid">
                            <div class="schedule-day">
                                <label class="schedule-toggle">
                                    <input type="checkbox" id="day-mon" checked> <span>Lunes</span>
                                </label>
                                <div class="schedule-hours">
                                    <input type="time" id="start-mon" value="09:00" title="Hora inicio lunes"> — <input type="time" id="end-mon" value="18:00" title="Hora fin lunes">
                                </div>
                            </div>
                            <div class="schedule-day">
                                <label class="schedule-toggle">
                                    <input type="checkbox" id="day-tue" checked> <span>Martes</span>
                                </label>
                                <div class="schedule-hours">
                                    <input type="time" id="start-tue" value="09:00" title="Hora inicio martes"> — <input type="time" id="end-tue" value="18:00" title="Hora fin martes">
                                </div>
                            </div>
                            <div class="schedule-day">
                                <label class="schedule-toggle">
                                    <input type="checkbox" id="day-wed" checked> <span>Miércoles</span>
                                </label>
                                <div class="schedule-hours">
                                    <input type="time" id="start-wed" value="09:00" title="Hora inicio miércoles"> — <input type="time" id="end-wed" value="18:00" title="Hora fin miércoles">
                                </div>
                            </div>
                            <div class="schedule-day">
                                <label class="schedule-toggle">
                                    <input type="checkbox" id="day-thu" checked> <span>Jueves</span>
                                </label>
                                <div class="schedule-hours">
                                    <input type="time" id="start-thu" value="09:00" title="Hora inicio jueves"> — <input type="time" id="end-thu" value="18:00" title="Hora fin jueves">
                                </div>
                            </div>
                            <div class="schedule-day">
                                <label class="schedule-toggle">
                                    <input type="checkbox" id="day-fri" checked> <span>Viernes</span>
                                </label>
                                <div class="schedule-hours">
                                    <input type="time" id="start-fri" value="09:00" title="Hora inicio viernes"> — <input type="time" id="end-fri" value="18:00" title="Hora fin viernes">
                                </div>
                            </div>
                            <div class="schedule-day">
                                <label class="schedule-toggle">
                                    <input type="checkbox" id="day-sat"> <span>Sábado</span>
                                </label>
                                <div class="schedule-hours">
                                    <input type="time" id="start-sat" value="10:00" disabled title="Hora inicio sábado"> — <input type="time" id="end-sat" value="14:00" disabled title="Hora fin sábado">
                                </div>
                            </div>
                            <div class="schedule-day">
                                <label class="schedule-toggle">
                                    <input type="checkbox" id="day-sun"> <span>Domingo</span>
                                </label>
                                <div class="schedule-hours">
                                    <input type="time" id="start-sun" value="10:00" disabled title="Hora inicio domingo"> — <input type="time" id="end-sun" value="14:00" disabled title="Hora fin domingo">
                                </div>
                            </div>
                        </div>
                        
                        <div class="calendar-options">
                            <div class="form-group">
                                <label>Duración de la cita (minutos)</label>
                                <select id="appointment-duration" title="Duración de la cita">
                                    <option value="15">15 minutos</option>
                                    <option value="30" selected>30 minutos</option>
                                    <option value="45">45 minutos</option>
                                    <option value="60">1 hora</option>
                                    <option value="90">1 hora 30 min</option>
                                    <option value="120">2 horas</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Margen entre citas (minutos)</label>
                                <select id="appointment-buffer" title="Margen entre citas">
                                    <option value="0">Sin margen</option>
                                    <option value="5">5 minutos</option>
                                    <option value="10" selected>10 minutos</option>
                                    <option value="15">15 minutos</option>
                                    <option value="30">30 minutos</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Antelación mínima para agendar</label>
                                <select id="appointment-advance" title="Antelación mínima">
                                    <option value="1">1 hora</option>
                                    <option value="2">2 horas</option>
                                    <option value="4" selected>4 horas</option>
                                    <option value="24">1 día</option>
                                    <option value="48">2 días</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Días máximos a futuro</label>
                                <select id="appointment-max-days" title="Días máximos a futuro">
                                    <option value="7">1 semana</option>
                                    <option value="14" selected>2 semanas</option>
                                    <option value="30">1 mes</option>
                                    <option value="60">2 meses</option>
                                </select>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" id="btn-save-calendar-config">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                    </div>
                    
                    <!-- Próximas citas -->
                    <div class="calendar-upcoming-section">
                        <h3><i class="fas fa-calendar-check"></i> Próximas Citas Agendadas</h3>
                        <div id="upcoming-appointments" class="appointments-list">
                            <div class="empty-state">
                                <i class="fas fa-calendar-plus"></i>
                                <p>No hay citas agendadas. Cuando un visitante agende a través del chatbot, aparecerán aquí.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Page -->
        <div id="page-settings" class="page">
            <div class="settings-container">
                <div class="settings-section">
                    <h3>Configuración del Modelo IA</h3>
                    <div class="form-group">
                        <label for="openai-api-key">API Key</label>
                        <input type="password" id="openai-api-key" class="form-control" placeholder="Tu API key...">
                    </div>
                    <div class="form-group">
                        <label for="openai-model">Modelo</label>
                        <select id="openai-model" class="form-control">
                            <option value="gemini-2.0-flash">Gemini 2.0 Flash (Recomendado)</option>
                            <option value="gemini-2.0-flash-lite">Gemini 2.0 Flash Lite</option>
                            <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="system-prompt">Prompt del Sistema</label>
                        <textarea id="system-prompt" class="form-control" rows="4"
                            placeholder="Eres un asistente útil..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="temperature">Temperatura</label>
                        <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7" class="form-range">
                        <span id="temperature-value">0.7</span>
                    </div>
                    <div class="form-group">
                        <label for="max-tokens">Tokens Máximos</label>
                        <input type="number" id="max-tokens" class="form-control" value="1000" min="1" max="8000">
                    </div>
                    <button class="btn btn-primary" id="save-settings" aria-label="Guardar configuración de IA">
                        <i class="fas fa-save"></i> Guardar Configuración
                    </button>
                </div>
                <div class="settings-section">
                    <h3>Configuración del Chatbot</h3>
                    <div class="form-group">
                        <label for="chatbot-name-input">Nombre del Chatbot</label>
                        <input type="text" id="chatbot-name-input" class="form-control" placeholder="Mi Chatbot">
                    </div>
                    <div class="form-group">
                        <label for="welcome-message">Mensaje de Bienvenida</label>
                        <textarea id="welcome-message" class="form-control" rows="2"
                            placeholder="¡Hola! ¿En qué puedo ayudarte?"></textarea>
                    </div>
                    <button class="btn btn-primary" id="save-chatbot-settings"
                        aria-label="Guardar configuración del chatbot">
                        <i class="fas fa-save"></i> Guardar Configuración
                    </button>
                </div>
            </div>
        </div>
        <!-- Functions Page -->
        <div id="page-functions" class="page">
            <div class="functions-container">
                <div class="functions-header">
                    <div>
                        <h2>Funciones</h2>
                        <p class="functions-description">Añade funcionalidades personalizadas que tu chatbot puede
                            ejecutar</p>
                    </div>
                    <button class="btn btn-primary" id="add-function-btn">
                        <i class="fas fa-plus"></i> Crear Función
                    </button>
                </div>
                <div class="functions-list" id="functions-list">
                    <!-- Functions will be loaded here -->
                    <div class="empty-state">
                        <i class="fas fa-code"></i>
                        <h3>No hay funciones configuradas</h3>
                        <p>Las funciones permiten que tu chatbot realice acciones específicas como buscar información,
                            realizar cálculos o conectarse con APIs externas.</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Quick Prompts Page -->
        <div id="page-prompts" class="page">
            <div class="prompts-layout">
                <!-- Header -->
                <div class="prompts-header-modern">
                    <div class="prompts-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="prompts-header-text">
                        <h2>Respuestas Rápidas</h2>
                        <p>Crea botones que aparecen sobre el input para que los usuarios accedan rápidamente a información</p>
                    </div>
                    <button class="btn-add-prompt" id="add-prompt-btn">
                        <i class="fas fa-plus"></i>
                        <span>Nueva Respuesta</span>
                    </button>
                </div>

                <!-- Info Card -->
                <div class="prompts-info-card">
                    <div class="info-card-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div class="info-card-content">
                        <h4>¿Cómo funcionan?</h4>
                        <p>Las respuestas rápidas son botones que aparecen en el chat. Cuando un usuario hace clic, se envía automáticamente el texto configurado como mensaje.</p>
                    </div>
                </div>

                <!-- Prompts Grid -->
                <div class="prompts-grid" id="prompts-list">
                    <!-- Example prompt cards - will be replaced by JS -->
                    <div class="prompt-card-empty">
                        <div class="empty-icon">
                            <i class="fas fa-comment-dots"></i>
                        </div>
                        <h3>Sin respuestas rápidas</h3>
                        <p>Añade tu primera respuesta rápida para mejorar la experiencia de tus usuarios</p>
                        <button class="btn-empty-add" id="add-prompt-empty">
                            <i class="fas fa-plus"></i> Crear primera respuesta
                        </button>
                    </div>
                </div>

                <!-- Preview Section -->
                <div class="prompts-preview-section">
                    <h3><i class="fas fa-eye"></i> Vista previa</h3>
                    <div class="prompts-preview-widget">
                        <div class="preview-chat-input">
                            <div class="preview-quick-prompts" id="preview-prompts">
                                <button class="preview-prompt-btn">¿Cuáles son sus horarios?</button>
                                <button class="preview-prompt-btn">¿Dónde están ubicados?</button>
                                <button class="preview-prompt-btn">Quiero hacer una reserva</button>
                            </div>
                            <div class="preview-input-bar">
                                <input type="text" placeholder="Escribe tu mensaje..." disabled>
                                <button class="preview-send" title="Enviar mensaje" aria-label="Enviar mensaje"><i class="fas fa-paper-plane"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Appearance Page -->
        <div id="page-appearance" class="page">
            <div class="appearance-layout">
                <!-- Left Panel - Settings -->
                <div class="appearance-settings">
                    <div class="appearance-header-modern">
                        <div class="appearance-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <div>
                            <h2>Personaliza tu Chatbot</h2>
                            <p>Configura la apariencia y comportamiento del widget</p>
                        </div>
                    </div>
                    
                    <!-- Modern Tabs -->
                    <div class="appearance-tabs-modern">
                        <button class="tab-btn-modern active" data-tab="content">
                            <i class="fas fa-align-left"></i>
                            <span>Contenido</span>
                        </button>
                        <button class="tab-btn-modern" data-tab="colors">
                            <i class="fas fa-palette"></i>
                            <span>Colores</span>
                        </button>
                        <button class="tab-btn-modern" data-tab="chat-bubble">
                            <i class="fas fa-comment-dots"></i>
                            <span>Burbuja</span>
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div class="appearance-panels">
                        <!-- Content Tab -->
                        <div class="appearance-panel active" data-content="content">
                            <div class="settings-card">
                                <h3 class="settings-card-title"><i class="fas fa-robot"></i> Identidad del Bot</h3>
                                <div class="form-group-modern">
                                    <label for="chatbot-name">Nombre del Chatbot</label>
                                    <input type="text" id="chatbot-name" class="input-modern" placeholder="Mi Asistente">
                                </div>
                                <div class="form-group-modern">
                                    <label for="welcome-message">Mensaje de Bienvenida</label>
                                    <textarea id="welcome-message" class="input-modern" rows="3" placeholder="¡Hola! ¿En qué puedo ayudarte?"></textarea>
                                    <span class="input-hint">El primer mensaje que verán los usuarios</span>
                                </div>
                                <div class="form-group-modern">
                                    <label for="input-placeholder">Placeholder del Input</label>
                                    <input type="text" id="input-placeholder" class="input-modern" placeholder="Escribe tu mensaje...">
                                </div>
                            </div>

                            <div class="settings-card">
                                <h3 class="settings-card-title"><i class="fas fa-image"></i> Imágenes</h3>
                                <div class="upload-grid">
                                    <div class="upload-item-modern">
                                        <div class="upload-preview">
                                            <i class="fas fa-robot"></i>
                                        </div>
                                        <div class="upload-info">
                                            <span class="upload-label">Avatar del Bot</span>
                                            <button class="btn-upload-modern">
                                                <i class="fas fa-cloud-upload-alt"></i> Subir
                                            </button>
                                            <input type="file" id="bot-avatar" accept="image/*" class="hidden-file-input" title="Subir avatar del bot" aria-label="Subir avatar del bot">
                                        </div>
                                    </div>
                                    <div class="upload-item-modern">
                                        <div class="upload-preview">
                                            <i class="fas fa-building"></i>
                                        </div>
                                        <div class="upload-info">
                                            <span class="upload-label">Logo Empresa</span>
                                            <button class="btn-upload-modern">
                                                <i class="fas fa-cloud-upload-alt"></i> Subir
                                            </button>
                                            <input type="file" id="company-logo" accept="image/*" class="hidden-file-input" title="Subir logo de empresa" aria-label="Subir logo de empresa">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-card">
                                <h3 class="settings-card-title"><i class="fas fa-sliders-h"></i> Opciones</h3>
                                <div class="toggle-list-modern">
                                    <div class="toggle-item-modern">
                                        <div class="toggle-content">
                                            <span class="toggle-label">Respuestas rápidas verticales</span>
                                            <span class="toggle-desc">Mostrar los botones en columna</span>
                                        </div>
                                        <label class="switch-modern">
                                            <input type="checkbox" id="display-prompts-vertical" title="Respuestas rápidas verticales">
                                            <span class="slider-modern"></span>
                                        </label>
                                    </div>
                                    <div class="toggle-item-modern">
                                        <div class="toggle-content">
                                            <span class="toggle-label">Ocultar avatar del bot</span>
                                            <span class="toggle-desc">Aspecto más minimalista</span>
                                        </div>
                                        <label class="switch-modern">
                                            <input type="checkbox" id="hide-bot-avatar" title="Ocultar avatar del bot">
                                            <span class="slider-modern"></span>
                                        </label>
                                    </div>
                                    <div class="toggle-item-modern">
                                        <div class="toggle-content">
                                            <span class="toggle-label">Ocultar fuentes</span>
                                            <span class="toggle-desc">No mostrar referencias usadas</span>
                                        </div>
                                        <label class="switch-modern">
                                            <input type="checkbox" id="hide-sources" title="Ocultar fuentes">
                                            <span class="slider-modern"></span>
                                        </label>
                                    </div>
                                    <div class="toggle-item-modern">
                                        <div class="toggle-content">
                                            <span class="toggle-label">Ocultar marca MIABOT</span>
                                            <span class="toggle-desc">Solo para cuentas de pago</span>
                                        </div>
                                        <label class="switch-modern">
                                            <input type="checkbox" id="hide-branding" title="Ocultar marca MIABOT">
                                            <span class="slider-modern"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Colors Tab -->
                        <div class="appearance-panel" data-content="colors">
                            <div class="settings-card">
                                <h3 class="settings-card-title"><i class="fas fa-fill-drip"></i> Colores Principales</h3>
                                
                                <div class="color-section">
                                    <div class="color-row">
                                        <div class="color-info">
                                            <span class="color-name">Color Principal</span>
                                            <span class="color-desc">Acentos y elementos destacados</span>
                                        </div>
                                        <div class="color-selector">
                                            <div class="color-presets">
                                                <button class="color-dot" data-color="#6366F1" title="Índigo"></button>
                                                <button class="color-dot" data-color="#8B5CF6" title="Púrpura"></button>
                                                <button class="color-dot" data-color="#3B82F6" title="Azul"></button>
                                                <button class="color-dot" data-color="#10B981" title="Verde"></button>
                                                <button class="color-dot" data-color="#F59E0B" title="Ámbar"></button>
                                                <button class="color-dot" data-color="#EF4444" title="Rojo"></button>
                                                <button class="color-dot" data-color="#EC4899" title="Rosa"></button>
                                                <button class="color-dot" data-color="#000000" title="Negro"></button>
                                            </div>
                                            <input type="color" id="primary-color-picker" class="color-input-modern" value="#6366F1" title="Color principal" aria-label="Seleccionar color principal">
                                        </div>
                                    </div>

                                    <div class="color-row">
                                        <div class="color-info">
                                            <span class="color-name">Fondo del Header</span>
                                            <span class="color-desc">Cabecera del widget</span>
                                        </div>
                                        <div class="color-selector">
                                            <div class="color-presets">
                                                <button class="color-dot active" data-color="#FFFFFF" title="Blanco"></button>
                                                <button class="color-dot" data-color="#F3F4F6" title="Gris claro"></button>
                                                <button class="color-dot" data-color="#1F2937" title="Oscuro"></button>
                                                <button class="color-dot" data-color="#6366F1" title="Índigo"></button>
                                            </div>
                                            <input type="color" id="header-bg-picker" class="color-input-modern" value="#FFFFFF" title="Fondo del header" aria-label="Seleccionar fondo del header">
                                        </div>
                                    </div>

                                    <div class="color-row">
                                        <div class="color-info">
                                            <span class="color-name">Texto del Header</span>
                                            <span class="color-desc">Título y estado</span>
                                        </div>
                                        <div class="color-selector">
                                            <div class="color-presets">
                                                <button class="color-dot active" data-color="#111827" title="Negro"></button>
                                                <button class="color-dot" data-color="#6B7280" title="Gris"></button>
                                                <button class="color-dot" data-color="#FFFFFF" title="Blanco"></button>
                                            </div>
                                            <input type="color" id="header-font-picker" class="color-input-modern" value="#111827" title="Texto del header" aria-label="Seleccionar color de texto del header">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-card">
                                <h3 class="settings-card-title"><i class="fas fa-comment-alt"></i> Burbujas de Chat</h3>
                                
                                <div class="color-section">
                                    <div class="color-row">
                                        <div class="color-info">
                                            <span class="color-name">Burbuja del Usuario</span>
                                            <span class="color-desc">Mensajes enviados</span>
                                        </div>
                                        <div class="color-selector">
                                            <div class="color-presets">
                                                <button class="color-dot" data-color="#6366F1" title="Índigo"></button>
                                                <button class="color-dot active" data-color="#10B981" title="Verde"></button>
                                                <button class="color-dot" data-color="#3B82F6" title="Azul"></button>
                                                <button class="color-dot" data-color="#8B5CF6" title="Púrpura"></button>
                                            </div>
                                            <input type="color" id="user-bubble-picker" class="color-input-modern" value="#10B981" title="Burbuja del usuario" aria-label="Seleccionar color de burbuja del usuario">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-card">
                                <h3 class="settings-card-title"><i class="fas fa-bolt"></i> Respuestas Rápidas</h3>
                                <p class="settings-card-desc">Personaliza el aspecto de los botones de respuesta rápida</p>
                                
                                <div class="color-grid-compact">
                                    <div class="color-mini">
                                        <label>Fondo</label>
                                        <input type="color" id="prompts-bg-picker" class="color-input-modern" value="#FFFFFF" title="Fondo de respuestas rápidas">
                                    </div>
                                    <div class="color-mini">
                                        <label>Borde</label>
                                        <input type="color" id="prompts-border-picker" class="color-input-modern" value="#E5E7EB" title="Borde de respuestas rápidas">
                                    </div>
                                    <div class="color-mini">
                                        <label>Texto</label>
                                        <input type="color" id="prompts-font-picker" class="color-input-modern" value="#374151" title="Texto de respuestas rápidas">
                                    </div>
                                </div>
                                
                                <div class="color-subsection">
                                    <span class="subsection-label">Estado Hover</span>
                                    <div class="color-grid-compact">
                                        <div class="color-mini">
                                            <label>Fondo</label>
                                            <input type="color" id="prompts-bg-hover-picker" class="color-input-modern" value="#F3F4F6" title="Fondo hover">
                                        </div>
                                        <div class="color-mini">
                                            <label>Borde</label>
                                            <input type="color" id="prompts-border-hover-picker" class="color-input-modern" value="#D1D5DB" title="Borde hover">
                                        </div>
                                        <div class="color-mini">
                                            <label>Texto</label>
                                            <input type="color" id="prompts-font-hover-picker" class="color-input-modern" value="#111827" title="Texto hover">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Bubble Tab -->
                        <div class="appearance-panel" data-content="chat-bubble">
                            <div class="settings-card">
                                <h3 class="settings-card-title"><i class="fas fa-expand-arrows-alt"></i> Tamaño y Posición</h3>
                                
                                <div class="settings-grid">
                                    <div class="form-group-modern">
                                        <label for="chat-icon-size">Tamaño del Icono</label>
                                        <select id="chat-icon-size" class="select-modern">
                                            <option value="small">Pequeño (48px)</option>
                                            <option value="medium" selected>Mediano (56px)</option>
                                            <option value="large">Grande (64px)</option>
                                        </select>
                                    </div>
                                    <div class="form-group-modern">
                                        <label for="position-screen">Posición</label>
                                        <select id="position-screen" class="select-modern">
                                            <option value="bottom-right" selected>Abajo Derecha</option>
                                            <option value="bottom-left">Abajo Izquierda</option>
                                            <option value="top-right">Arriba Derecha</option>
                                            <option value="top-left">Arriba Izquierda</option>
                                        </select>
                                    </div>
                                    <div class="form-group-modern">
                                        <label for="distance-bottom">Distancia Inferior</label>
                                        <div class="input-with-unit">
                                            <input type="number" id="distance-bottom" class="input-modern" value="16" min="0" max="100">
                                            <span class="unit">px</span>
                                        </div>
                                    </div>
                                    <div class="form-group-modern">
                                        <label for="distance-side">Distancia Lateral</label>
                                        <div class="input-with-unit">
                                            <input type="number" id="distance-side" class="input-modern" value="16" min="0" max="100">
                                            <span class="unit">px</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-card">
                                <h3 class="settings-card-title"><i class="fas fa-icons"></i> Icono de la Burbuja</h3>
                                
                                <div class="icon-grid-modern">
                                    <button class="icon-option" data-icon="comment" title="Comentario">
                                        <i class="fas fa-comment"></i>
                                    </button>
                                    <button class="icon-option" data-icon="comment-dots" title="Chat">
                                        <i class="fas fa-comment-dots"></i>
                                    </button>
                                    <button class="icon-option active" data-icon="comments" title="Conversación">
                                        <i class="fas fa-comments"></i>
                                    </button>
                                    <button class="icon-option" data-icon="headset" title="Soporte">
                                        <i class="fas fa-headset"></i>
                                    </button>
                                    <button class="icon-option" data-icon="robot" title="Robot">
                                        <i class="fas fa-robot"></i>
                                    </button>
                                    <button class="icon-option" data-icon="question-circle" title="Ayuda">
                                        <i class="fas fa-question-circle"></i>
                                    </button>
                                    <button class="icon-option" data-icon="life-ring" title="Salvavidas">
                                        <i class="fas fa-life-ring"></i>
                                    </button>
                                    <button class="icon-option" data-icon="whatsapp" title="WhatsApp">
                                        <i class="fab fa-whatsapp"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="settings-card">
                                <h3 class="settings-card-title"><i class="fas fa-palette"></i> Colores de la Burbuja</h3>
                                
                                <div class="color-section">
                                    <div class="color-row">
                                        <div class="color-info">
                                            <span class="color-name">Color de Fondo</span>
                                        </div>
                                        <div class="color-selector">
                                            <div class="color-presets">
                                                <button class="color-dot active" data-color="#8B5CF6" title="Púrpura"></button>
                                                <button class="color-dot" data-color="#6366F1" title="Índigo"></button>
                                                <button class="color-dot" data-color="#3B82F6" title="Azul"></button>
                                                <button class="color-dot" data-color="#10B981" title="Verde"></button>
                                                <button class="color-dot" data-color="#EF4444" title="Rojo"></button>
                                                <button class="color-dot" data-color="#000000" title="Negro"></button>
                                            </div>
                                            <input type="color" id="bubble-bg-picker" class="color-input-modern" value="#8B5CF6" title="Fondo de burbuja" aria-label="Seleccionar color de fondo de burbuja">
                                        </div>
                                    </div>
                                    <div class="color-row">
                                        <div class="color-info">
                                            <span class="color-name">Color del Icono</span>
                                        </div>
                                        <div class="color-selector">
                                            <div class="color-presets">
                                                <button class="color-dot active" data-color="#FFFFFF" title="Blanco"></button>
                                                <button class="color-dot" data-color="#000000" title="Negro"></button>
                                            </div>
                                            <input type="color" id="bubble-icon-picker" class="color-input-modern" value="#FFFFFF" title="Color de icono de burbuja" aria-label="Seleccionar color de icono de burbuja">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-card">
                                <h3 class="settings-card-title"><i class="fas fa-comment-alt"></i> Mensaje de Burbuja</h3>
                                
                                <div class="form-group-modern">
                                    <label for="bubble-message">Texto del tooltip</label>
                                    <input type="text" id="bubble-message" class="input-modern" placeholder="¿Necesitas ayuda?">
                                    <span class="input-hint">Aparece cuando el chat está cerrado</span>
                                </div>
                                
                                <div class="color-row compact">
                                    <div class="color-mini">
                                        <label>Fondo</label>
                                        <input type="color" id="bubble-msg-bg-picker" class="color-input-modern" value="#8B5CF6" title="Fondo del mensaje">
                                    </div>
                                    <div class="color-mini">
                                        <label>Texto</label>
                                        <input type="color" id="bubble-msg-color-picker" class="color-input-modern" value="#FFFFFF" title="Color del texto">
                                    </div>
                                </div>
                            </div>

                            <div class="settings-card">
                                <h3 class="settings-card-title"><i class="fas fa-code"></i> CSS Personalizado</h3>
                                <div class="form-group-modern">
                                    <textarea id="custom-bubble-css" class="input-modern code-textarea" rows="4" placeholder=".chat-bubble { /* Tu CSS aquí */ }"></textarea>
                                    <span class="input-hint">Los cambios no se reflejan en tiempo real</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div class="appearance-save-bar">
                        <button class="btn-save-modern" id="save-appearance">
                            <i class="fas fa-save"></i> Guardar Cambios
                        </button>
                    </div>
                </div>

                <!-- Right Panel - Preview -->
                <div class="appearance-preview-panel">
                    <div class="preview-header">
                        <h3><i class="fas fa-eye"></i> Vista Previa</h3>
                        <span class="preview-badge">En tiempo real</span>
                    </div>
                    <div class="browser-mockup">
                        <div class="browser-header">
                            <div class="browser-dots">
                                <span class="dot red"></span>
                                <span class="dot yellow"></span>
                                <span class="dot green"></span>
                            </div>
                            <div class="browser-address-bar">
                                <i class="fas fa-lock"></i>
                                <span>tusitio.com</span>
                            </div>
                        </div>
                        <div class="browser-content">
                            <div class="website-mockup">
                                <div class="mockup-header">
                                    <div class="mockup-logo"></div>
                                    <div class="mockup-nav">
                                        <div class="mockup-nav-item"></div>
                                        <div class="mockup-nav-item"></div>
                                        <div class="mockup-nav-item"></div>
                                    </div>
                                </div>
                                <div class="mockup-hero">
                                    <div class="mockup-title"></div>
                                    <div class="mockup-subtitle"></div>
                                    <div class="mockup-button"></div>
                                </div>
                            </div>
                            <div class="chatbot-preview-widget">
                                <div class="chat-window active" id="preview-chat-window">
                                    <div class="chat-window-header" id="preview-header">
                                        <div class="chat-header-info">
                                            <div class="chat-avatar">
                                                <i class="fas fa-robot"></i>
                                            </div>
                                            <div class="chat-header-text">
                                                <h4 id="preview-bot-name">Mi Asistente</h4>
                                                <span class="chat-status"><i class="fas fa-circle"></i> En línea</span>
                                            </div>
                                        </div>
                                        <button class="chat-close-btn" title="Cerrar chat" aria-label="Cerrar chat">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    <div class="chat-window-messages">
                                        <div class="chat-message bot">
                                            <div class="message-avatar"><i class="fas fa-robot"></i></div>
                                            <div class="message-bubble" id="preview-welcome">¡Hola! ¿En qué puedo ayudarte?</div>
                                        </div>
                                        <div class="chat-message user">
                                            <div class="message-bubble" id="preview-user-bubble">Hola, tengo una pregunta</div>
                                        </div>
                                    </div>
                                    <div class="chat-window-input">
                                        <input type="text" id="preview-input" placeholder="Escribe tu mensaje..." class="chat-preview-input">
                                        <button class="chat-send-btn" title="Enviar mensaje" aria-label="Enviar mensaje"><i class="fas fa-paper-plane"></i></button>
                                    </div>
                                </div>
                                <button class="chat-bubble-btn" id="preview-bubble" title="Abrir chat" aria-label="Abrir chat">
                                    <i class="fas fa-comments" id="preview-bubble-icon"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Integrations Page -->
        <div id="page-integrations" class="page">
            <div class="integrations-container">
                <div class="integration-card">
                    <div class="integration-header">
                        <h3><i class="fas fa-code"></i> Widget JavaScript</h3>
                    </div>
                    <p>Copia y pega este código antes del cierre <code>&lt;/body&gt;</code> en tu sitio web:</p>
                    <div class="code-block">
                        <pre id="integration-code"><code>Selecciona un chatbot para ver el código de integración</code></pre>
                        <button class="btn-copy" id="copy-integration-code" aria-label="Copiar código de integración">
                            <i class="fas fa-copy"></i> Copiar
                        </button>
                    </div>
                </div>
                <div class="integration-card">
                    <div class="integration-header">
                        <h3><i class="fas fa-plug"></i> API REST</h3>
                    </div>
                    <p>Envía mensajes a tu chatbot programáticamente:</p>
                    <div class="api-endpoint">
                        <strong>POST</strong> <span id="api-endpoint-url">/api/chat</span>
                        <div class="code-block">
                            <pre id="api-example-code"><code>{
  "message": "Hola, ¿qué servicios ofrecen?",
  "chatbotId": "TU_CHATBOT_ID",
  "sessionId": "session_opcional"
}</code></pre>
                            <button class="btn-copy" id="copy-api-code" aria-label="Copiar ejemplo API">
                                <i class="fas fa-copy"></i> Copiar
                            </button>
                        </div>
                    </div>
                </div>
                <div class="integration-card">
                    <div class="integration-header">
                        <h3><i class="fas fa-share-alt"></i> Enlace Directo</h3>
                    </div>
                    <p>Comparte este enlace para que tus usuarios accedan al chat:</p>
                    <div class="code-block">
                        <pre id="direct-link-code"><code>Selecciona un chatbot</code></pre>
                        <button class="btn-copy" id="copy-direct-link" aria-label="Copiar enlace directo">
                            <i class="fas fa-copy"></i> Copiar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </main>
    <!-- Modals -->
    <!-- Upload Files Modal -->
    <div id="upload-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Subir Archivos de Entrenamiento</h3>
                <button class="modal-close" aria-label="Cerrar modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="upload-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Arrastra y suelta archivos aquí o haz clic para buscar</p>
                    <input type="file" id="file-input" multiple accept=".pdf,.docx,.txt"
                        aria-label="Seleccionar archivos">
                </div>
                <div id="upload-progress" class="upload-progress hidden">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <p id="upload-status">Subiendo...</p>
                </div>
            </div>
        </div>
    </div>
    <!-- URL Training Modal -->
    <div id="url-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Entrenar desde URL</h3>
                <button class="modal-close" aria-label="Cerrar modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="training-url">URL del Sitio Web</label>
                    <input type="url" id="training-url" class="form-control" placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label for="crawl-subpages">
                        <input type="checkbox" id="crawl-subpages">
                        Rastrear subpáginas
                    </label>
                </div>
                <button class="btn btn-primary" id="start-url-training" aria-label="Iniciar entrenamiento desde URL">
                    <i class="fas fa-play"></i> Iniciar Entrenamiento
                </button>
            </div>
        </div>
    </div>
    <!-- Text Training Modal -->
    <div id="text-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Añadir Texto de Entrenamiento</h3>
                <button class="modal-close" aria-label="Cerrar modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="training-text">Texto de Entrenamiento</label>
                    <textarea id="training-text" class="form-control" rows="10"
                        placeholder="Introduce tus datos de entrenamiento aquí..."></textarea>
                </div>
                <button class="btn btn-primary" id="save-training-text" aria-label="Guardar datos de entrenamiento">
                    <i class="fas fa-save"></i> Guardar Datos de Entrenamiento
                </button>
            </div>
        </div>
    </div>
    <!-- New Chatbot Modal -->
    <div id="new-chatbot-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Crear Nuevo Chatbot</h3>
                <button class="modal-close" aria-label="Cerrar modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="new-chatbot-name">Nombre del Chatbot *</label>
                    <input type="text" id="new-chatbot-name" class="form-control" placeholder="ej., Centro Médico"
                        required>
                </div>
                <div class="form-group">
                    <label for="new-chatbot-description">Descripción</label>
                    <textarea id="new-chatbot-description" class="form-control" rows="3"
                        placeholder="Breve descripción de este chatbot..."></textarea>
                </div>
                <div class="form-group">
                    <label for="new-chatbot-api-key">Clave API (opcional)</label>
                    <input type="password" id="new-chatbot-api-key" class="form-control" placeholder="Tu API key...">
                    <small>Déjalo vacío para usar Gemini con la clave por defecto del servidor</small>
                </div>
                <div class="form-group">
                    <label for="new-chatbot-model">Modelo</label>
                    <select id="new-chatbot-model" class="form-control">
                        <option value="gemini-2.0-flash" selected>Gemini 2.0 Flash (Recomendado)</option>
                        <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                        <option value="gpt-4o-mini">GPT-4o Mini</option>
                        <option value="gpt-4o">GPT-4o</option>
                        <option value="gpt-4-turbo">GPT-4 Turbo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="new-chatbot-prompt">Prompt del Sistema</label>
                    <textarea id="new-chatbot-prompt" class="form-control" rows="4"
                        placeholder="Eres un asistente útil...">Eres un asistente útil y amigable.</textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary modal-close" aria-label="Cancelar">Cancelar</button>
                    <button class="btn btn-primary" id="create-chatbot-btn" aria-label="Crear chatbot">
                        <i class="fas fa-plus"></i> Crear Chatbot
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Quick Prompt Editor Modal -->
    <div id="prompt-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="prompt-modal-title">Añadir Respuesta Rápida</h3>
                <button class="modal-close" aria-label="Cerrar modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="prompt-button-title">
                        <i class="fas fa-tag"></i> Título del Botón <span class="required">*</span>
                    </label>
                    <input type="text" id="prompt-button-title" class="form-input"
                        placeholder="Ej: Pricing, Contacto, Agendar cita" maxlength="50">
                    <small class="form-hint">Este es el texto que verán tus usuarios en el botón</small>
                </div>
                <div class="form-group">
                    <label for="prompt-link">
                        <i class="fas fa-link"></i> Enlace Externo <span class="optional">(Opcional)</span>
                    </label>
                    <input type="url" id="prompt-link" class="form-input" placeholder="https://ejemplo.com/pricing">
                    <small class="form-hint">El botón abrirá este enlace en una nueva pestaña</small>
                </div>
                <div class="form-group">
                    <label for="prompt-text">
                        <i class="fas fa-comment-dots"></i> Mensaje al Chatbot <span class="optional">(Opcional)</span>
                    </label>
                    <textarea id="prompt-text" class="form-textarea"
                        placeholder="Ej: ¿Cuáles son sus precios y planes disponibles?" rows="4"></textarea>
                    <small class="form-hint">Este mensaje se enviará automáticamente al chatbot</small>
                </div>
                <div class="form-notice">
                    <i class="fas fa-lightbulb"></i>
                    <p>Puedes elegir entre un <strong>Enlace Externo</strong> o un <strong>Mensaje al Chatbot</strong>.
                        Si añades ambos, el enlace tendrá prioridad.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-prompt-btn">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn btn-primary" id="save-prompt-btn">
                    <i class="fas fa-check"></i> Guardar Respuesta Rápida
                </button>
            </div>
        </div>
    </div>
    <!-- Function Editor Modal -->
    <div id="function-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="function-modal-title">Crear Función</h3>
                <button class="modal-close" aria-label="Cerrar modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="function-name">Nombre de la Función *</label>
                    <input type="text" id="function-name" class="form-control" placeholder="ej., buscar_producto"
                        required>
                    <small>Solo letras, números y guiones bajos. Sin espacios.</small>
                </div>
                <div class="form-group">
                    <label for="function-description">Descripción *</label>
                    <textarea id="function-description" class="form-control" rows="2"
                        placeholder="Describe qué hace esta función..." required></textarea>
                    <small>Explica claramente qué hace la función para que el chatbot sepa cuándo usarla.</small>
                </div>
                <div class="form-group">
                    <label>Parámetros</label>
                    <div id="parameters-list" class="parameters-list">
                        <!-- Parameters will be added here -->
                    </div>
                    <button type="button" class="btn btn-secondary btn-sm" id="add-parameter-btn">
                        <i class="fas fa-plus"></i> Añadir Parámetro
                    </button>
                </div>
                <div class="form-group">
                    <label for="function-endpoint">URL del Endpoint *</label>
                    <input type="url" id="function-endpoint" class="form-control"
                        placeholder="https://api.example.com/action" required>
                    <small>La URL donde se enviará la solicitud cuando se llame a esta función.</small>
                </div>
                <div class="form-group">
                    <label for="function-method">Método HTTP</label>
                    <select id="function-method" class="form-control">
                        <option value="GET">GET</option>
                        <option value="POST" selected>POST</option>
                        <option value="PUT">PUT</option>
                        <option value="DELETE">DELETE</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="function-headers">Headers (JSON)</label>
                    <textarea id="function-headers" class="form-control code-textarea" rows="4"
                        placeholder='{"Authorization": "Bearer tu_token", "Content-Type": "application/json"}'></textarea>
                    <small>Headers HTTP en formato JSON.</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="function-enabled">
                        Función Habilitada
                    </label>
                    <small class="d-block">Si está deshabilitada, el chatbot no podrá usar esta función.</small>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary modal-close">Cancelar</button>
                    <button class="btn btn-primary" id="save-function-btn">
                        <i class="fas fa-save"></i> Guardar Función
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/dashboard.js"></script>
    <script src="/js/training.js"></script>
    <script src="/js/test-chatbot.js"></script>
    <script src="/js/wizard.js"></script>
    <script src="/js/preview.js"></script>
    <script src="/js/conversations.js"></script>
    <script src="/js/settings.js"></script>
    <script src="/js/functions.js"></script>
    <script src="/js/prompts.js"></script>
    <script src="/js/integrations.js"></script>
    <script src="/js/calendar.js"></script>
</body>
</html>